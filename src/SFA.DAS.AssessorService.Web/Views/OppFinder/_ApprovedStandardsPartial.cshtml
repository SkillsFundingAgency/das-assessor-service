@using SFA.DAS.AssessorService.Domain.Paging
@using SFA.DAS.AssessorService.Api.Types.Models
@using SFA.DAS.AssessorService.Web.ViewModels.OppFinder
@model OppFinderSearchViewModel

@{ var approvedTotalRecordCount = (Model?.ApprovedStandards.TotalRecordCount ?? 0); }
    <p class="govuk-body">
        @if (!string.IsNullOrEmpty(Model?.SearchTerm))
        {
            <text>Showing </text>
            <span class="govuk-!-font-weight-bold">@approvedTotalRecordCount</span>
            @if (approvedTotalRecordCount == 1){<text> result</text>}else{<text> results</text>}
        }
        else
        {
            <text>Showing <span class="govuk-!-font-weight-bold">@approvedTotalRecordCount</span> approved Standards</text>
        }
    </p>
@if (approvedTotalRecordCount == 0)
{
    await Html.RenderPartialAsync("_NoSearchResults");
}
else
{
    <table class="govuk-table govuk-table--small">
        <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header">
                    <sfa-sortable-column-header 
                        class="approved-sort govuk-link"
                        data-sortColumn="@nameof(OppFinderApprovedSearchSortColumn.StandardName)"
                        asp-action="SortApprovedStandards"
                        asp-controller="OppFinder"
                        asp-fragment="approved"
                        sfa-sort-column="@nameof(OppFinderApprovedSearchSortColumn.StandardName)"
                        sfa-table-sort-column="@Model.ApprovedSortColumn"
                        sfa-sort-direction="@Model.ApprovedSortDirection"
                    >Approved Standards</sfa-sortable-column-header>
                </th>
                <th scope="col" class="govuk-table__header govuk-table__header--numeric govuk-!-width-one-fifth">
                    <sfa-sortable-column-header 
                        class="approved-sort govuk-link"
                        data-sortColumn="@nameof(OppFinderApprovedSearchSortColumn.ActiveApprentices)"
                        asp-action="SortApprovedStandards"
                        asp-controller="OppFinder"
                        asp-fragment="approved"
                        sfa-sort-column="@nameof(OppFinderApprovedSearchSortColumn.ActiveApprentices)"
                        sfa-table-sort-column="@Model.ApprovedSortColumn"
                        sfa-sort-direction="@Model.ApprovedSortDirection"
                    >Active apprentices</sfa-sortable-column-header>
                </th>
                <th scope="col" class="govuk-table__header govuk-table__header--numeric govuk-!-width-one-fifth">
                    <sfa-sortable-column-header 
                        class="approved-sort govuk-link"
                        data-sortColumn="@nameof(OppFinderApprovedSearchSortColumn.RegisteredEPAOs)"
                        asp-action="SortApprovedStandards"
                        asp-controller="OppFinder"
                        asp-fragment="approved"
                        sfa-sort-column="@nameof(OppFinderApprovedSearchSortColumn.RegisteredEPAOs)"
                        sfa-table-sort-column="@Model.ApprovedSortColumn"
                        sfa-sort-direction="@Model.ApprovedSortDirection"
                    >Registered EPAO's</sfa-sortable-column-header>
                </th>
            </tr>
        </thead>
        <tbody class="govuk-table__body">
            @if (Model?.ApprovedStandards != null)
            {
                @foreach (var approvedStandard in Model.ApprovedStandards.Items.ConvertAll(x => x as OppFinderApprovedSearchResult))
                {
                    <tr class="govuk-table__row">
                        <td class="govuk-table__cell">
                            <a 
                                class="govuk-link"
                                asp-action="ShowApprovedStandardDetails" 
                                asp-controller="OppFinder" 
                                asp-route-standardCode="@approvedStandard.StandardCode">@approvedStandard.StandardName
                            </a>
                        </td>
                        <td class="govuk-table__cell govuk-table__cell--numeric">@approvedStandard.ActiveApprentices</td>
                        <td class="govuk-table__cell govuk-table__cell--numeric">@approvedStandard.RegisteredEPAOs</td>
                    </tr>
                }
            }
        </tbody>
    </table>
    @if (Model != null)
    {
        <form asp-action="ShowApprovedStandardsPerPage" asp-controller="OppFinder" method="get" asp-fragment="approved">
            <div class="das-flex-space-around">
                <div>
                    <select class="approved-per-page govuk-select govuk-!-margin-right-2" asp-for="ApprovedStandardsPerPage" asp-items="Model.StandardsPerPage"></select>
                    <text>Standards per page</text>
                </div>
                <div class="das-pagination-links">
                    @{await Html.RenderPartialAsync("_PaginationLinksPartial", new OppFinderPaginationViewModel
                    {
                        Standards = Model.ApprovedStandards,
                        PageIndex = Model.ApprovedPageIndex,
                        ChangePageAction = "ChangePageApprovedStandards",
                        Fragment = "approved"
                    });}
                </div>
            </div>
            <button class="govuk-button govuk-!-margin-bottom-0 govuk-!-margin-top-3 js-hidden" type="submit">
                Update table
            </button>
        </form>
    }
}