@using SFA.DAS.AssessorService.Domain.Paging
@using SFA.DAS.AssessorService.Api.Types.Models
@using SFA.DAS.AssessorService.Web.ViewModels.OppFinder
@model OppFinderSearchViewModel

@{ var approvedTotalRecordCount = (Model?.ApprovedStandards.TotalRecordCount ?? 0); }
    <span>
        @if (!string.IsNullOrEmpty(Model?.SearchTerm))
        {
            <text>Showing </text>
            <span class="govuk-!-font-weight-bold">@approvedTotalRecordCount</span>
            @if (approvedTotalRecordCount == 1){<text> result</text>}else{<text> results</text>}
        }
        else
        {
            <text>Showing <span class="govuk-!-font-weight-bold">@approvedTotalRecordCount</span> approved Standards</text>
        }
    </span>
@if (approvedTotalRecordCount == 0)
{
    await Html.RenderPartialAsync("_NoSearchResults");
}
else
{
    <table class="govuk-table">
        <thead class="govuk-table__head">
        <tr class="govuk-table__row">
            <th scope="col" class="govuk-table__header">
                <sfa-sortable-column-header class="approved-sort"
                                            data-sortColumn="@nameof(OppFinderApprovedSearchSortColumn.StandardName)"
                                            asp-action="SortApprovedStandards"
                                            asp-controller="OppFinder"
                                            asp-fragment="approved"
                                            sfa-sort-column="@nameof(OppFinderApprovedSearchSortColumn.StandardName)"
                                            sfa-table-sort-column="@Model.ApprovedSortColumn"
                                            sfa-sort-direction="@Model.ApprovedSortDirection">
                    Approved Standards
                </sfa-sortable-column-header>
            </th>
            <th scope="col" class="govuk-table__header">
                <sfa-sortable-column-header class="approved-sort"
                                            data-sortColumn="@nameof(OppFinderApprovedSearchSortColumn.ActiveApprentices)"
                                            asp-action="SortApprovedStandards"
                                            asp-controller="OppFinder"
                                            asp-fragment="approved"
                                            sfa-sort-column="@nameof(OppFinderApprovedSearchSortColumn.ActiveApprentices)"
                                            sfa-table-sort-column="@Model.ApprovedSortColumn"
                                            sfa-sort-direction="@Model.ApprovedSortDirection">
                    Active apprentices
                </sfa-sortable-column-header>
            </th>
            <th scope="col" class="govuk-table__header">
                <sfa-sortable-column-header class="approved-sort"
                                            data-sortColumn="@nameof(OppFinderApprovedSearchSortColumn.RegisteredEPAOs)"
                                            asp-action="SortApprovedStandards"
                                            asp-controller="OppFinder"
                                            asp-fragment="approved"
                                            sfa-sort-column="@nameof(OppFinderApprovedSearchSortColumn.RegisteredEPAOs)"
                                            sfa-table-sort-column="@Model.ApprovedSortColumn"
                                            sfa-sort-direction="@Model.ApprovedSortDirection">
                    Registered EPAO's
                </sfa-sortable-column-header>
            </th>
        </tr>
        </thead>
        <tbody class="govuk-table__body">
    @if (Model?.ApprovedStandards != null)
    {
        @foreach (var approvedStandard in Model.ApprovedStandards.Items.ConvertAll(x => x as OppFinderApprovedSearchResult))
        {
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">
                    <a 
                        asp-action="ShowApprovedStandardDetails" 
                        asp-controller="OppFinder" 
                        asp-route-standardCode="@approvedStandard.StandardCode">@approvedStandard.StandardName
                    </a>
                </td>
                <td class="govuk-table__cell">@approvedStandard.ActiveApprentices</td>
                <td class="govuk-table__cell">@approvedStandard.RegisteredEPAOs</td>
            </tr>
        }
    }
        </tbody>
    </table>
    @if (Model != null)
    {
        <form asp-action="ShowApprovedStandardsPerPage" asp-controller="OppFinder" method="get" asp-fragment="approved">
            <select class="approved-per-page" asp-for="ApprovedStandardsPerPage" asp-items="Model.StandardsPerPage"></select>
            <button class="govuk-button govuk-button--looks-like-link govuk-button--looks-like-link--inline js-hidden" type="submit">
                Show
            </button>
            <text>Standards per page</text>
        </form>

        await Html.RenderPartialAsync("_PaginationLinksPartial", new OppFinderPaginationViewModel
        {
            Standards = Model.ApprovedStandards,
            PageIndex = Model.ApprovedPageIndex,
            ChangePageAction = "ChangePageApprovedStandards",
            ChangePageSetAction = "ChangePageSetApprovedStandards",
            Fragment = "approved"
        }); 
    }
}

