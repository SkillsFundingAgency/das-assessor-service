
@using System.Text.RegularExpressions;

@model SFA.DAS.AssessorService.Web.ViewModels.Organisation.OrganisationSearchViewModel

@{
    ViewBag.Title = "Confirm organisation";
    Layout = "_Layout";
    
    var organisation = Model.Organisations?.FirstOrDefault();
    var organisationType = Model.OrganisationTypes?.FirstOrDefault(ot => ot.Type == organisation?.OrganisationType);

    var epaoRegex = new Regex(@"[eE][pP][aA][0-9]{4,9}$");
    var epaoId = organisation?.Id?.Split(',').FirstOrDefault(id => epaoRegex.Match(id).Success);
}

<a asp-action="Results" asp-controller="OrganisationSearch" asp-route-searchString="@Model.SearchString" class="link-back">Back to search results</a>

<div class="grid-row">
    @if (organisation != null)
    {
        <div class="column-full">
            <form method="post" asp-action="DealingWithRequest" asp-controller="OrganisationSearch" novalidate>
                <input asp-for="SearchString" type="hidden" />
                <input asp-for="Name" type="hidden" />
                <input asp-for="Ukprn" type="hidden" />
                <input asp-for="OrganisationType" type="hidden" />
                <input asp-for="Postcode" type="hidden" />


                <div class="form-group">
                    @if (organisation.OrganisationReferenceType  != "RoEPAO")
                    {
                        <div class="panel panel-border-wide">
                            <p>
                                <span class="bold-small"> @Model.Name</span> is not recognised as a registered organisation.
                                If you continue, you will be taken to the new organisation registration application.
                            </p>
                        </div>
                    }
                    <h1 class="heading-xlarge">Confirm organisation</h1>

                    <h2 class="heading-medium">@organisation.Name</h2>

                    @if (organisation.Address?.Postcode != null)
                    {
                        <p class="bold govuk-margin-bottom-0">Address</p>
                        <p>@string.Join(", ", organisation.Address?.Address1, organisation.Address?.City, organisation.Address.Postcode)</p>
                    }

                    @if (organisation.TradingName != null || organisation.ProviderName != null)
                    {
                        <p class="bold govuk-margin-bottom-0">Trading name</p>
                        <p >@(organisation.TradingName ?? organisation.ProviderName)</p>
                    }

                    @if (organisationType?.TypeDescription != null)
                    {
                        <p class="bold govuk-margin-bottom-0">Type</p>
                        <p>@organisationType.TypeDescription</p>
                    }

                    @if (organisation.Ukprn != null)
                    {
                        <p class="bold govuk-margin-bottom-0">UKPRN</p>
                        <p>@organisation.Ukprn</p>
                    }

                    @if (epaoId != null)
                    {
                        <p class="bold govuk-margin-bottom-0">EPAO ID</p>
                        <p>@epaoId</p>
                    }

                    @if (organisation.CompanyNumber != null)
                    {
                        <p class="bold govuk-margin-bottom-0">Company number</p>
                        <p>@organisation.CompanyNumber</p>
                    }

                    @if (organisation.CharityNumber != null)
                    {
                        <p class="bold govuk-margin-bottom-0">Charity number</p>
                        <p>@organisation.CharityNumber</p>
                    }
                </div>
                <button type="submit" class="button">Confirm</button>
            </form>

            <p class="govuk-body-anchor">
                <a class="link" asp-action="Results" asp-controller="OrganisationSearch" asp-route-searchString="@Model.SearchString">Choose a different organisation</a>
            </p>
        </div>
    }
    else
    {
        <div class="column-full">
            <div class="form-group">
                <h1 class="heading-large">We cannot find your organisation details</h1>
                <p>Check the:</p>
                <ul class="list list-bullet ">
                    <li>spelling of the name</li>
                    <li><abbr title="UK provider reference number">UKPRN</abbr> is correct</li>
                    <li><abbr title="End-point assessor organisation">EPAO ID</abbr> is correct</li>
                    <li>company number</li>
                    <li>charity number</li>
                </ul>
            </div>

            <p class="govuk-body-anchor">
                <a class="link" asp-action="Results" asp-controller="OrganisationSearch" asp-route-searchString="@Model.SearchString">Back to search results</a>
            </p>
        </div>
    }
</div>